{{ define "main" }}

<article class="post-single">
  <header class="post-title">
    <p>
      {{ if .Date }}
      <time>{{ .Date | time.Format ":date_medium" }}</time>
      {{ end }}
      {{ if or .Params.Author site.Author.name }}
      <span>{{ .Params.Author | default site.Author.name }}</span>
      {{ end }}
    </p>
    <h1>{{ .Title }}</h1>
  </header>
  <section class="post-content">  
    {{ with .Params.cover }}
    {{ $image := resources.Get . }}
    {{- $imageSmall := $image.Resize "1280x q80" -}}
    {{- $imageSmallWebp := $image.Resize "1280x webp q80" -}}
    {{- $imageMedium := $image.Resize "1920x q80" -}}
    {{- $imageMediumWebp := $image.Resize "1920x webp q80" -}}
    <picture>
      <source 
        media="(max-width: 640px)" 
        srcset="{{ $imageSmallWebp.RelPermalink }}"
        type="image/webp"
      >
    <source 
      media="(min-width: 640px)"
      srcset="{{ $imageMediumWebp.RelPermalink }}"
      type="image/webp"
    >
    <img 
      srcset="{{ $imageSmall.RelPermalink }} 640w, {{ $imageMedium.RelPermalink }} 800w"
      sizes="(max-width: 640px) 640px, 800px"
      src="{{ $imageSmall.RelPermalink }}" 
    >
  </picture>
    <br />
  {{- end -}}

  <aside class="table-of-content">
    <span> Table of Content </span>
    {{ .TableOfContents }}
  </aside>
  {{ .Content }}
  </section>
  <!-- Post Tags -->
  {{ if .Params.tags }}
  <footer class="post-tags">
    {{ range .Params.tags }} {{ $href := print (absURL "tags/") (urlize .) }}
    <a href="{{ $href }}">{{ . }}</a>
    {{ end }}
  </footer>
  {{ end }}

  <!-- Post Nav -->
  {{ $pages := where site.RegularPages "Type" "in" site.Params.mainSections }}<!---->
  {{ if and (gt (len $pages) 1) (in $pages . ) }}
  <nav class="post-nav">
    {{ with $pages.Next . }}
    <a class="prev" href="{{ .Permalink }}"><span>←</span><span>{{ .Name }}</span></a>
    {{ end }} {{ with $pages.Prev . }}
    <a class="next" href="{{ .Permalink }}"><span>{{ .Name }}</span><span>→</span></a>
    {{ end }}
  </nav>
  {{ end }}

  <!-- Disqus -->
  {{ if and site.DisqusShortname (not (eq .Params.comments false)) }}
  <div id="disqus_thread" class="post-comments"></div>
  <script>
    var disqusShortname = '{{ site.DisqusShortname }}';
    var script = document.createElement('script');
    script.src = 'https://' + disqusShortname + '.disqus.com/embed.js';
    script.setAttribute('data-timestamp', +new Date());
    document.head.appendChild(script);
  </script>
  {{ end }}
</article>

{{ end }}
